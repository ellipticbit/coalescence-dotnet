before_script:
  - "git clean -fdxq"
  - "git submodule sync --recursive"
  - "git submodule foreach --recursive git reset --hard"
  - "git submodule update --init --recursive"

Shared Test Deployment:
  tags:
    - linux
    - dotnet

  except:
    refs:
      - master
  only:
      changes:
      - ./Shared/**

  script:
    - "dotnet restore ./Shared/Shared.csproj"
    - "pwsh -f \"./ReplaceVersion-Shared.ps1\""
    - "dotnet pack -c Debug -o ./ ./Shared/Shared.csproj"

Shared Production Deployment:
  tags:
    - linux
    - dotnet

  only:
    refs:
      - master
    changes:
      - ./Shared/**

  script:
    - "dotnet restore ./Shared/Shared.csproj"
    - "pwsh -f \"./ReplaceVersion-Shared.ps1\""
    - "dotnet pack -c Release -o ./ ./Shared/Shared.csproj"
    - "dotnet nuget push *.nupkg -k %NUGET_API_KEY% -s \"https://www.nuget.org\""
